# UI自动化控制工具开发工作计划

这是一个深度、可执行的工作计划树，旨在指导UI自动化控制工具的开发。该工具将基于FastAPI框架，提供一套RESTful API来与桌面环境进行交互。

## 当前进度

- ✅ 已完成 `tools/uictrl.py` 的实现，包含所有API端点
- ✅ 已实现基于FastAPI的API服务器
- ✅ 已实现所有核心功能（窗口操作、截图、鼠标键盘控制等）

## 工作计划树 (Mermaid)

```mermaid
graph TD
    A[UI自动化控制工具开发] --> B[阶段一: 项目初始化与FastAPI服务器搭建];
    A --> C[阶段二: 核心窗口功能实现 (平台特定)];
    A --> D[阶段三: API端点实现];
    A --> E[阶段四: 文档与测试];

    B --> B1[1.1: 初始化FastAPI项目];
    B --> B2[1.2: 设计API接口];
    B --> B3[1.3: 实现基础服务器结构];

    C --> C1[2.1: 实现窗口枚举功能];
    C --> C2[2.2: 实现窗口信息获取];
    C --> C3[2.3: 实现窗口截图功能];
    C --> C4[2.4: 实现窗口控制 (移动, 缩放, 关闭等)];
    C --> C5[2.5: 实现命令执行功能];
    C --> C6[2.6: 实现鼠标控制 (点击, 移动等)];
    C --> C7[2.7: 实现键盘输入];

    D --> D1[3.1: 实现 /windows (GET) 端点];
    D --> D2[3.2: 实现 /windows/{window_id} (GET) 端点];
    D --> D3[3.3: 实现 /windows/{window_id}/screenshot (GET) 端点];
    D --> D4[3.4: 实现 /windows/{window_id}/control (POST) 端点];
    D --> D5[3.5: 实现 /execute (POST) 端点];
    D --> D6[3.6: 实现 /windows/{window_id}/mouse (POST) 端点];
    D --> D7[3.7: 实现 /windows/{window_id}/keyboard (POST) 端点];

    E --> E1[4.1: 编写API文档 (tools/uictrl_readme.md)];
    E --> E2[4.2: 编写单元/集成测试];
    E --> E3[4.3: 优化与最终交付];
```

## 任务详解

### 阶段一: 项目初始化与FastAPI服务器搭建

#### 1.1: 初始化FastAPI项目
*   **描述**: 创建一个新的Python项目，安装FastAPI, Uvicorn以及其他必要的依赖。建立标准的项目结构，例如 `app/`, `tests/` 等目录。
*   **可交付成果**: 一个可以运行 "Hello World" 的基础FastAPI应用。

#### 1.2: 设计API接口
*   **描述**: 详细定义所有API端点的URL、HTTP方法、请求参数/体和响应结构。这将作为后续API实现的蓝图。
*   **可交付成果**: API设计文档初稿，包含所有端点的规格说明。

#### 1.3: 实现基础服务器结构
*   **描述**: 搭建FastAPI应用的核心逻辑，包括路由设置、配置文件管理、日志记录和全局异常处理。
*   **可交付成果**: 一个结构良好、可扩展的FastAPI服务器骨架。

### 阶段二: 核心窗口功能实现 (平台特定)

这个阶段的工作与操作系统紧密相关，需要为Windows, macOS, Linux等目标平台分别实现或找到合适的库来完成。

#### 2.1: 实现窗口枚举功能
*   **描述**: 编写代码来扫描当前桌面环境，列出所有可见的顶层窗口。每个窗口需要有一个唯一的标识符（例如句柄）。
*   **可交付成果**: 一个函数，调用后返回当前所有窗口的ID和标题列表。

#### 2.2: 实现窗口信息获取
*   **描述**: 编写代码，根据指定的窗口ID，获取该窗口的详细信息，如标题、位置、大小、所属进程等。
*   **可交付成果**: 一个函数，输入窗口ID，返回包含该窗口详细信息的结构体或字典。

#### 2.3: 实现窗口截图功能
*   **描述**: 编写代码，对指定ID的窗口进行截图，并能将截图数据以图片格式（如PNG或JPEG）返回。
*   **可交付成果**: 一个函数，输入窗口ID，返回该窗口的截图图像数据。

#### 2.4: 实现窗口控制
*   **描述**: 编写代码，实现对指定ID窗口的基本控制，包括但不限于移动到指定位置、调整大小、最小化、最大化、恢复和关闭。
*   **可交付成果**: 一组函数，每个函数实现一种窗口控制操作。

#### 2.5: 实现命令执行功能
*   **描述**: 编写代码，可以在操作系统中异步执行一个新的命令或启动一个新进程。需要能够处理命令的输入输出和错误流。
*   **可交付成果**: 一个函数，可以启动新进程并返回进程ID或其他标识符。

#### 2.6: 实现鼠标控制
*   **描述**: 编写代码，在指定窗口的相对坐标上模拟鼠标操作，如移动、单击、双击、右击和拖拽。
*   **可交付成果**: 一组函数，用于在窗口内分发鼠标事件。

#### 2.7: 实现键盘输入
*   **描述**: 编写代码，向指定窗口发送键盘输入，包括输入文本字符串和模拟单个按键（如Enter, Ctrl, F5等）。
*   **可交付成果**: 一组函数，用于向窗口发送文本和按键事件。

### 阶段三: API端点实现

将阶段二实现的核心功能通过FastAPI暴露为Web API。

#### 3.1: 实现 /windows (GET) 端点
*   **描述**: 创建一个API端点，调用窗口枚举功能，返回所有窗口的列表。
*   **可交付成果**: 一个有效的 `/windows` API。

#### 3.2: 实现 /windows/{window_id} (GET) 端点
*   **描述**: 创建一个API端点，接收窗口ID作为路径参数，返回该窗口的详细信息。
*   **可交付成果**: 一个有效的 `/windows/{window_id}` API。

#### 3.3: 实现 /windows/{window_id}/screenshot (GET) 端点
*   **描述**: 创建一个API端点，返回指定窗口的截图。响应类型应为图片格式。
*   **可交付成果**: 一个有效的 `/windows/{window_id}/screenshot` API。

#### 3.4: 实现 /windows/{window_id}/control (POST) 端点
*   **描述**: 创建一个API端点，接收控制指令（如 `action: "move"`, `x: 100`, `y: 100`），并对指定窗口执行相应操作。
*   **可交付成果**: 一个有效的 `/windows/{window_id}/control` API。

#### 3.5: 实现 /execute (POST) 端点
*   **描述**: 创建一个API端点，接收要执行的命令，并在服务器上异步执行。
*   **可交付成果**: 一个有效的 `/execute` API。

#### 3.6: 实现 /windows/{window_id}/mouse (POST) 端点
*   **描述**: 创建API端点，用于在指定窗口内执行鼠标操作。请求体应包含操作类型（如click）和坐标。
*   **可交付成果**: 一个有效的 `/windows/{window_id}/mouse` API。

#### 3.7: 实现 /windows/{window_id}/keyboard (POST) 端点
*   **描述**: 创建API端点，用于向指定窗口发送文本输入或按键。请求体应包含要输入的内容。
*   **可交付成果**: 一个有效的 `/windows/{window_id}/keyboard` API。

### 阶段四: 文档与测试

#### 4.1: 编写API文档 (tools/uictrl_readme.md)
*   **描述**: 使用FastAPI的自动文档生成功能（Swagger UI / ReDoc），并编写一份清晰、完整的API参考文档。这份文档将保存在 `tools/uictrl_readme.md`。
*   **可交付成果**: 完整的API文档。

#### 4.2: 编写单元/集成测试
*   **描述**: 使用`pytest`等框架为核心功能和API端点编写测试用例，确保代码质量和稳定性。
*   **可交付成果**: 一套覆盖主要功能的测试代码。

#### 4.3: 优化与最终交付
*   **描述**: 进行代码审查、性能优化和错误修复。准备最终的可部署版本。
*   **可交付成果**: 一个稳定、可靠且文档齐全的UI自动化控制工具。 