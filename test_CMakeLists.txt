cmake_minimum_required(VERSION 3.16)
project(AntivirusTest VERSION 1.0.0)

set(CMAKE_C_STANDARD 99)
set(CMAKE_C_STANDARD_REQUIRED ON)

if(WIN32)
    set(CMAKE_MSVC_RUNTIME_LIBRARY "MultiThreadedDLL")
    if(MSVC)
        add_compile_options(/GS /sdl /guard:cf)
        add_link_options(/DYNAMICBASE /NXCOMPAT /SAFESEH /GUARD:CF)
    endif()
    set(CMAKE_C_FLAGS_RELEASE "/O2 /DNDEBUG")
elseif(UNIX)
    add_compile_options(-O2 -fstack-protector-strong -D_FORTIFY_SOURCE=2 -fPIC)
    add_link_options(-Wl,-z,relro -Wl,-z,now -Wl,-z,noexecstack)
endif()

add_executable(antivirus_test test_antivirus_build.c)

if(WIN32)
    target_link_libraries(antivirus_test kernel32 user32)
endif()

set_target_properties(antivirus_test PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin
    OUTPUT_NAME "antivirus_test"
)
