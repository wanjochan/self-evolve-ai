# Replace TinyCC 工作计划

## 项目概述
- 工作ID: replace_tcc
- 目标: 完全使用自主开发的c99bin来代替TinyCC，实现无外部依赖基准线
- 优先级: 高
- 状态: IN_PROGRESS (进行中)
- 总体进度: 30% (T1完成, T2.1完成)

## 项目背景

### 当前状态
- ✅ c99bin编译器已完成开发 (100%功能完整)
- ✅ c99bin.sh包装器已实现 (提供cc.sh兼容接口)
- ✅ 完整测试套件已验证 (跨平台兼容性确认)
- ⚠️ 项目仍依赖TinyCC作为主要编译器

### 目标愿景
实现项目完全自给自足，不依赖任何外部编译器，建立无外部依赖的基准线，为后续AI自我进化奠定基础。

## 任务分解

### T1 [100%] 依赖分析和评估 ✅ COMPLETED
- T1.1 [100%] ✅ 分析项目中所有使用cc.sh的地方 (54处使用，已分类)
- T1.2 [100%] ✅ 评估c99bin.sh替代cc.sh的可行性 (25%可直接替代)
- T1.3 [100%] ✅ 识别需要特殊处理的编译场景 (分为3个优先级)
- T1.4 [100%] ✅ 制定渐进式替换策略 (3阶段策略)

### T2 [25%] 构建系统改造
- T2.1 [100%] ✅ 修改build_*.sh脚本使用c99bin.sh (Phase 1完成，37%成功率)
- T2.2 [0%] 更新Makefile和构建配置
- T2.3 [0%] 修改模块构建脚本
- T2.4 [0%] 确保向后兼容性

### T3 [0%] 核心组件迁移
- T3.1 [0%] 迁移核心模块编译 (layer0, pipeline, compiler, libc)
- T3.2 [0%] 迁移工具链编译 (c2astc, astc2native等)
- T3.3 [0%] 迁移测试程序编译
- T3.4 [0%] 迁移示例程序编译

### T4 [0%] 兼容性增强
- T4.1 [0%] 增强c99bin对复杂C代码的支持
- T4.2 [0%] 实现多文件编译支持
- T4.3 [0%] 添加库链接功能
- T4.4 [0%] 改进错误处理和诊断

### T5 [0%] 测试和验证
- T5.1 [0%] 全面回归测试
- T5.2 [0%] 性能对比测试 (c99bin vs TinyCC)
- T5.3 [0%] 稳定性长期测试
- T5.4 [0%] 跨平台兼容性验证

### T6 [0%] 文档和清理
- T6.1 [0%] 更新所有相关文档
- T6.2 [0%] 清理TinyCC相关代码和配置
- T6.3 [0%] 更新README和使用指南
- T6.4 [0%] 创建迁移指南

## 详细任务说明

### T1.1: 项目依赖分析
- 扫描所有脚本文件中的cc.sh使用
- 分析编译参数和选项使用情况
- 识别关键编译路径和依赖关系
- 生成完整的依赖关系图

### T1.2: 可行性评估
- 测试c99bin.sh在现有构建流程中的表现
- 识别不兼容的编译选项和场景
- 评估性能影响和资源需求
- 制定风险缓解策略

### T2.1: 构建系统改造
- 修改build_core.sh使用c99bin.sh
- 修改build_tools.sh使用c99bin.sh
- 修改build_c99bin_module.sh使用c99bin.sh
- 确保所有构建脚本的一致性

### T3.1: 核心模块迁移
- 测试layer0_module使用c99bin编译
- 测试pipeline_module使用c99bin编译
- 测试compiler_module使用c99bin编译
- 测试libc_module使用c99bin编译

### T4.1: 兼容性增强
- 分析现有代码的复杂C语法使用
- 增强c99bin对结构体、指针、数组的支持
- 实现预处理器指令支持
- 添加更多标准库函数支持

## 风险评估

### 高风险项
1. **复杂C代码兼容性**: c99bin目前只支持简单C程序
2. **多文件编译**: c99bin不支持多文件项目编译
3. **库链接**: c99bin缺乏完整的库链接功能
4. **性能影响**: 可能影响构建速度和可执行文件性能

### 缓解策略
1. **渐进式迁移**: 先迁移简单组件，逐步扩展
2. **混合模式**: 保留cc.sh作为复杂场景的备选
3. **功能增强**: 根据需要扩展c99bin功能
4. **回退机制**: 确保可以快速回退到TinyCC

## 成功标准

### 阶段性目标
1. **Phase 1**: 50%的构建任务使用c99bin.sh
2. **Phase 2**: 80%的构建任务使用c99bin.sh
3. **Phase 3**: 100%的构建任务使用c99bin.sh，完全移除TinyCC依赖

### 最终目标
- ✅ 项目完全不依赖外部编译器
- ✅ 所有核心功能正常工作
- ✅ 性能不低于原有水平
- ✅ 跨平台兼容性保持
- ✅ 完整的文档和迁移指南

## 时间规划

### 短期 (1-2周)
- T1: 依赖分析和评估
- T2: 构建系统改造

### 中期 (2-4周)
- T3: 核心组件迁移
- T4: 兼容性增强

### 长期 (4-6周)
- T5: 测试和验证
- T6: 文档和清理

## 下一步行动

1. **T1.1 项目依赖分析** - 扫描所有cc.sh使用情况
2. **T1.2 可行性评估** - 测试c99bin.sh在关键场景中的表现
3. **T2.1 构建系统改造** - 开始修改核心构建脚本
4. **风险评估** - 识别和规划高风险迁移项目
