# 工作计划 core

本文档包含工作流 core 的动态任务规划和分解。

## 工作流信息
- 工作ID: core
- 创建时间: 2024-12-28
- 状态: COMPLETED (已完成)
- 描述: 根据 src/core/modules/modules.md 调整 src/core/ 中的系统架构实现，特别是 pipeline 和 compiler 模块要有实际实现，不要是 stub 存根假代码
- 总体进度: 100%
- 完成时间: 2025-07-07
- 特别注意：不要做历史纪录，只更新最后结果！

## 任务树

- T1 [100%] 系统架构分析与设计 ✅
  - T1.1 [100%] 分析现有模块实现状态 ✅
  - T1.2 [100%] 识别 stub 存根代码 ✅
  - T1.3 [100%] 制定实现计划 ✅
- T2 [100%] Pipeline模块ASTC流水线实现 ✅ [CRITICAL]
  - T2.1 [100%] 定义ASTC字节码格式 ✅
  - T2.2 [100%] Frontend: c2astc 实现 (C代码→ASTC字节码) ✅
  - T2.3 [100%] Backend: codegen 实现 (ASTC字节码→ASTC汇编) ✅
  - T2.4 [100%] Backend: astc2native 实现 (ASTC汇编→原生代码) ✅
  - T2.5 [100%] Execution: ASTC VM 实现 (ASTC字节码执行) ✅
- T3 [100%] Compiler模块ASTC集成 ✅ [CRITICAL]
  - T3.1 [100%] JIT编译器实现 (ASTC字节码→原生机器码) ✅
  - T3.2 [100%] FFI接口实现 (外部函数接口) ✅
- T4 [100%] 核心基础设施补全 ✅ [PARALLEL]
  - T4.1 [100%] Module模块依赖管理实现 ✅
  - T4.2 [100%] ASTC核心函数实现 ✅
  - T4.3 [100%] 模块系统完善 ✅
- T5 [100%] 模块集成与测试 ✅
  - T5.1 [100%] 模块间接口验证 ✅
  - T5.2 [100%] 端到端测试 ✅
  - T5.3 [100%] 构建系统验证 ✅

## 任务详情

### T1: 系统架构分析与设计
- 优先级: 高
- 依赖: 无
- 描述: 分析现有模块实现状态，识别需要实现的功能

### T1.1: 分析现有模块实现状态
- 优先级: 高
- 依赖: 无
- 描述: 检查 pipeline_module.c 和 compiler_module.c 的实现状态
- 完成标准: 明确哪些是 stub 代码，哪些是实际实现

### T1.2: 识别 stub 存根代码
- 优先级: 高
- 依赖: T1.1
- 描述: 识别所有 stub 存根代码，列出需要实现的功能
- 完成标准: 生成详细的功能实现清单

### T1.3: 制定实现计划
- 优先级: 高
- 依赖: T1.2
- 描述: 根据 modules.md 制定具体的实现计划
- 完成标准: 实现计划文档完成

### T2: Pipeline模块实现
- 优先级: 高
- 依赖: T1.3
- 描述: 实现完整的编译流水线功能
- 挑战: 确保各个组件能够正确协作

### T2.1: Frontend: c2astc 实现
- 优先级: 高
- 依赖: T1.3
- 描述: 实现 C 代码到 ASTC 字节码的转换
- 完成标准: 能够解析基本的 C 代码并生成 ASTC 字节码

### T2.2: Backend: codegen 实现
- 优先级: 高
- 依赖: T2.1
- 描述: 实现 ASTC 字节码到 ASTC 汇编的转换
- 完成标准: 能够生成可执行的 ASTC 汇编代码

### T2.3: Backend: astc2native 实现
- 优先级: 高
- 依赖: T2.2
- 描述: 实现 AOT 编译功能，将 ASTC 字节码转换为原生机器码
- 完成标准: 能够生成可执行的原生二进制文件

### T2.4: Execution: astc + vm 实现
- 优先级: 高
- 依赖: T2.2
- 描述: 实现 ASTC 字节码执行环境
- 完成标准: 能够执行 ASTC 字节码程序

### T3: Compiler模块实现
- 优先级: 高
- 依赖: T1.3
- 描述: 实现特殊编译方式的集成
- 挑战: JIT 编译器的复杂性

### T3.1: JIT编译器实现
- 优先级: 高
- 依赖: T2.1
- 描述: 实现运行时即时编译功能
- 完成标准: 能够在运行时将 ASTC 字节码编译为原生机器码

### T3.2: FFI接口实现
- 优先级: 中
- 依赖: T1.3
- 描述: 实现外部函数接口，支持调用外部库
- 完成标准: 能够调用外部 C 库函数

### T4: 模块集成与测试
- 优先级: 中
- 依赖: T2, T3
- 描述: 集成所有模块并进行测试

## 并行任务管理

### 并行任务组定义
使用 `[PARALLEL]` 标记可以并行执行的任务组：

1. **T2 Pipeline模块实现 [PARALLEL]**
   - 并行原因: 不同组件可以同时开发
   - 同步点: 接口定义完成后
   - 预期时间节省: 40%

2. **T3 Compiler模块实现 [PARALLEL]**
   - 并行原因: JIT 和 FFI 可以同时开发
   - 同步点: 基础架构完成后
   - 预期时间节省: 30%

### 并行执行策略
- **资源分配**: 确保每个并行任务有足够的资源
- **依赖管理**: 明确任务间的依赖关系和同步点
- **进度监控**: 实时跟踪各并行任务的进度
- **风险控制**: 识别并行执行可能带来的风险

### 同步检查点
- T1.3完成后，T2和T3可以开始并行执行
- T2.1完成后，T3.1可以开始
- T2和T3完成后，T4可以开始

## 动态规划笔记

- 需要重点关注现有代码的质量，避免重写已经工作的部分
- Pipeline模块的各个组件需要统一的接口设计
- JIT编译器是最复杂的部分，可能需要分阶段实现
- 测试驱动开发，确保每个组件都有对应的测试用例
- **并行优化**: 当前计划中有2个并行任务组，预计可节省总时间35%
- **风险评估**: 需要特别注意模块间的接口兼容性 